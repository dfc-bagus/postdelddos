<!DOCTYPE html>
<html>
<head>
    <title>URL Persistence Example</title>
</head>
<body>
    <!-- URL Input Kolom -->
    <div style="padding: 20px; background: #f5f5f5;">
        <label for="urlInput">Masukkan URL:</label><br>
        <input 
            type="url" 
            id="urlInput" 
            placeholder="https://example.com" 
            style="width: 300px; padding: 8px; margin: 10px 0;"
        >
        <br>
        <button onclick="updateContent()" style="padding: 8px 16px;">
            Terapkan URL
        </button>
    </div>

    <!-- Area untuk menampilkan konten -->
    <div id="contentArea" style="padding: 20px; margin-top: 20px; border: 1px solid #ddd;">
        Konten akan diubah di sini berdasarkan URL
    </div>

    <script>
        // Fungsi utama yang dihubungkan ke URL
        function executeMainScript(url) {
            // Simpan URL ke localStorage agar bertahan setelah reload
            localStorage.setItem('lastUsedURL', url);
            
            // Ubah konten head dan body
            document.head.innerHTML = `<title>URL: ${url}</title>
                                       <style>
                                           body { font-family: Arial, sans-serif; }
                                           .url-info { 
                                               background: #e8f4f8; 
                                               padding: 10px; 
                                               margin: 10px 0;
                                               border-left: 4px solid #2196F3;
                                           }
                                       </style>`;
            
            // Update body content
            document.body.innerHTML = `
                <div style="padding: 20px; background: #f5f5f5;">
                    <label for="urlInput">Masukkan URL:</label><br>
                    <input 
                        type="url" 
                        id="urlInput" 
                        placeholder="https://example.com" 
                        value="${url}"
                        style="width: 300px; padding: 8px; margin: 10px 0;"
                    >
                    <br>
                    <button onclick="updateContent()" style="padding: 8px 16px;">
                        Terapkan URL
                    </button>
                </div>
                
                <div id="contentArea" style="padding: 20px; margin-top: 20px; border: 1px solid #ddd;">
                    <div class="url-info">
                        <strong>URL Aktif:</strong> ${url}<br>
                        <strong>Waktu Load:</strong> ${new Date().toLocaleString()}
                    </div>
                    <h2>Konten dari URL: ${url}</h2>
                    <p>URL ini telah disimpan dan akan tetap aktif meskipun halaman direload.</p>
                    <div id="dynamicContent"></div>
                </div>
            `;

            // Definisikan custom property
            Object.defineProperty(document, 'kamuSiapa', {
                get: function() {
                    const element = document.createElement('div');
                    element.innerHTML = `
                        <div style="background: #e8f5e8; padding: 15px; margin: 20px 0; border-radius: 5px; border: 1px solid #4CAF50;">
                            <h3>Custom Property "kamuSiapa"</h3>
                            <p><strong>Sumber URL:</strong> ${url}</p>
                            <p><strong>Dibuat pada:</strong> ${new Date().toLocaleTimeString()}</p>
                            <p><strong>Status:</strong> Aktif dan tersimpan di localStorage</p>
                        </div>
                    `;
                    return element;
                },
                configurable: true
            });

            // Tampilkan properti custom di content area
            const dynamicContent = document.getElementById('dynamicContent');
            if (dynamicContent) {
                dynamicContent.appendChild(document.kamuSiapa);
            }

            // Re-attach event listener
            const urlInput = document.getElementById('urlInput');
            if (urlInput) {
                urlInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        updateContent();
                    }
                });
            }
            
            // Tampilkan log
            console.log('URL diterapkan dan disimpan:', url);
            console.log('Properti document.kamuSiapa aktif untuk URL:', url);
        }

        // Fungsi untuk memperbarui konten berdasarkan URL input
        function updateContent() {
            const urlInput = document.getElementById('urlInput');
            let url = '';
            
            if (urlInput) {
                url = urlInput.value.trim();
            }
            
            if (!url) {
                alert('Silakan masukkan URL terlebih dahulu!');
                return;
            }
            
            // Validasi format URL sederhana
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url; // Auto-correct
            }
            
            // Eksekusi script utama dengan URL
            executeMainScript(url);
        }

        // Fungsi untuk memeriksa dan memuat URL dari localStorage saat halaman dimuat
        function loadSavedURL() {
            const savedURL = localStorage.getItem('lastUsedURL');
            
            if (savedURL) {
                // Jika ada URL yang disimpan, langsung eksekusi
                console.log('Memuat URL yang disimpan:', savedURL);
                executeMainScript(savedURL);
            } else {
                // Jika tidak ada URL yang disimpan, tampilkan halaman awal
                const currentURL = window.location.href;
                document.getElementById('urlInput').value = currentURL;
                
                // Tampilkan instruksi
                document.getElementById('contentArea').innerHTML += `
                    <div style="background: #fff8e1; padding: 20px; margin-top: 20px; border-radius: 5px; border: 1px solid #ffc107;">
                        <h3>Instruksi:</h3>
                        <ol>
                            <li>Masukkan URL pada input di atas</li>
                            <li>Klik "Terapkan URL" atau tekan Enter</li>
                            <li>URL akan disimpan di localStorage</li>
                            <li>Reload halaman untuk melihat URL tetap aktif</li>
                            <li>Untuk mengubah URL, masukkan URL baru dan klik "Terapkan URL"</li>
                        </ol>
                        <p><strong>Catatan:</strong> URL yang dimasukkan akan tetap aktif meskipun browser ditutup dan dibuka kembali.</p>
                    </div>
                `;
                
                // Tambahkan event listener untuk input
                document.getElementById('urlInput').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        updateContent();
                    }
                });
                
                console.log('Tidak ada URL yang disimpan. Silakan masukkan URL baru.');
            }
        }

        // Jalankan saat halaman dimuat
        window.addEventListener('DOMContentLoaded', loadSavedURL);

        // Tambahkan event listener untuk sebelum unload (opsional)
        window.addEventListener('beforeunload', function() {
            console.log('URL aktif tersimpan:', localStorage.getItem('lastUsedURL'));
        });
    </script>
</body>
    </html>
